# 아키텍처

## 시스템 구조

```
┌──────────────┐     MCP (stdio)     ┌──────────────────┐
│  Claude Code │ ◄─────────────────► │  Jarvis Server   │
│  (LLM Host)  │                     │  (FastMCP)       │
└──────────────┘                     │                  │
                                     │  ┌────────────┐  │
                                     │  │ Auth Module │  │
                                     │  │ (OAuth 2.0) │  │
                                     │  └─────┬──────┘  │
                                     │        │         │
                                     │  ┌─────┴──────┐  │
                                     │  │   Tools    │  │
                                     │  │ - Calendar │  │
                                     │  │ - Gmail    │  │
                                     │  └─────┬──────┘  │
                                     └────────┼─────────┘
                                              │
                                              ▼
                                     ┌──────────────────┐
                                     │   Google APIs     │
                                     │ - Calendar API   │
                                     │ - Gmail API      │
                                     └──────────────────┘
```

## 기술 스택

| 구성 요소 | 기술 | 선택 이유 |
|-----------|------|-----------|
| 언어 | Python 3.12+ | Google API 공식 클라이언트 지원, 빠른 개발 |
| MCP 프레임워크 | FastMCP | Python MCP 구현 표준, 간결한 API |
| 패키지 관리 | uv | 빠른 의존성 관리, 가상환경 자동 관리 |
| Google API | google-api-python-client | 공식 클라이언트, 안정적 |
| 인증 | google-auth-oauthlib | OAuth 2.0 표준 구현 |
| 향후 호스팅 | Cloudflare Workers | 무료 티어, 글로벌 엣지 |

## 핵심 모듈

### 1. Auth Module (`src/jarvis/auth/`)

- Google OAuth 2.0 인증 흐름 관리
- 토큰 저장/갱신 자동화
- 스코프 관리 (Calendar, Gmail)

### 2. Tools Module (`src/jarvis/tools/`)

- 각 Google 서비스별 MCP 도구 정의
- 입력 검증 및 에러 처리
- 응답 포맷팅

### 3. Server (`src/jarvis/server.py`)

- FastMCP 서버 초기화
- 도구 등록
- 진입점

## 데이터 흐름

1. 사용자가 Claude Code에서 자연어 명령 입력
2. Claude가 적절한 MCP 도구 선택 및 파라미터 구성
3. FastMCP 서버가 도구 호출 수신
4. Auth 모듈에서 Google API 인증 토큰 확보
5. 해당 도구 함수가 Google API 호출 실행
6. 결과를 포맷팅하여 Claude에게 반환
7. Claude가 사용자에게 자연어로 결과 전달

---

## 의사결정 기록 (ADR)

### ADR-001: MCP 프레임워크로 FastMCP 선택

- **날짜**: 2025-02-11
- **상태**: 채택
- **맥락**: MCP 서버 구현을 위한 Python 프레임워크 필요
- **결정**: FastMCP 사용
- **이유**:
  - Python MCP SDK 공식 고수준 API
  - 데코레이터 기반의 간결한 도구 정의
  - 타입 힌트 기반 자동 스키마 생성
- **결과**: 최소한의 보일러플레이트로 도구 정의 가능

### ADR-002: 패키지 관리자로 uv 선택

- **날짜**: 2025-02-11
- **상태**: 채택
- **맥락**: Python 패키지 관리 및 가상환경 도구 필요
- **결정**: uv 사용 (pip/poetry 대신)
- **이유**:
  - 빠른 의존성 해결 속도
  - pyproject.toml 네이티브 지원
  - 가상환경 자동 관리
- **결과**: `uv sync` 한 줄로 환경 구성 완료

### ADR-003: 로컬 우선 실행 전략

- **날짜**: 2025-02-11
- **상태**: 채택
- **맥락**: MCP 서버 실행 환경 결정
- **결정**: 로컬 stdio 모드로 시작, 향후 HTTP 모드 전환
- **이유**:
  - 개발/디버깅 편의성
  - 외부 서버 비용 없음
  - Claude Code가 stdio MCP 지원
- **결과**: 클라우드 배포 없이 즉시 사용 가능
